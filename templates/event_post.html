{% extends 'base.html' %}

{% block stylesheet %}

<style>
  /* ===================== 기본 텍스트 스타일 ===================== */

  .entryfee {
    color: #7a69b8;
    font-size: 14px;
    font-weight: bold;
  }

  /* ===================== 이미지 스타일 ===================== */

  img {
    width: 70px;
    height: 70px;
  }

  /* ===================== 페이지네이션 스타일 ===================== */

  .pagination {
    display: flex;
    justify-content: center;
    padding: 0;
    list-style-type: none;
  }

  .pagination li {
    margin: 0 5px;
  }

  .pagination a {
    text-decoration: none;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .pagination a.disabled {
    color: #ccc;
    pointer-events: none;
    border-color: #ddd;
  }

  .pagination a.active {
    background-color: #007bff;
    color: white;
    font-weight: bold;
    border-color: #0056b3;
    cursor: default;
  }

  /* ===================== 정사각형 칼럼 스타일 ===================== */

  .square-column {
    position: relative;
    width: 100%;
    padding-bottom: 100%;
    overflow: hidden;
  }

  .event-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 50%;
    object-fit: cover;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
    border: 1px solid #ddd;
  }

  .event-details {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50%;
    padding: 10px;
    box-sizing: border-box;
    color: #333;
  }

  /* ===================== 고정 네비게이션 스타일 ===================== */
  /* ===================== 고정 네비게이션 스타일 ===================== */



  /* 이벤트 리스트 마진 조정 */
  #events-list {
    margin-right: 270px;
    /* 네비게이션 너비만큼 오른쪽 여백을 추가하여 겹치지 않게 */
  }


  /* 필터링 버튼 */
  /* 필터 리스트 기본 숨김 처리 */
  .filter-list {
    display: none;
    /* 기본적으로 숨겨짐 */
    position: absolute;
    /* 버튼 아래로 표시 */
    top: 100%;
    /* 버튼 아래에 위치 */
    width: 200px;
    /* 필터의 너비 설정 */
    background-color: white;
    border: 1px solid #ccc;
    /* 테두리 설정 */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    /* 그림자 추가 */
    z-index: 1000;
    /* 필터 리스트가 다른 요소 위로 오도록 설정 */
  }

  .filter-list.active {
    display: block;
    /* active 클래스가 있으면 보이도록 */
  }

  #filter-toggle-btn {
    position: relative;
    cursor: pointer;
    /* 클릭할 수 있음을 표시 */
  }

/* ===================== 버튼 스타일 ===================== */
.custom-btn {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: bold;
  display: inline-block;
  transition: background-color 0.3s ease;
}

.custom-btn:hover {
  background-color: #3e8de052;
}

/* 버튼 리스트 */
.button-list {
  display: flex;
  justify-content: space-between; /* 양쪽 끝에 정렬하고 간격을 균등하게 분배 */
  width: 100%; /* 부모 컨테이너의 너비에 맞추기 */
  padding: 0;
  list-style: none;
}
.button-list li {
  display: inline-block;
}

/* ===================== 필터 리스트 스타일 ===================== */
.filter-list {
  display: none;
  position: absolute;
  top: 100%;
  width: 200px;
  background-color: white;
  border: 1px solid #ccc;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  z-index: 1000;
}

.filter-list.active {
  display: block;
}



  /* ===================== 카테고리 체크박스 스타일 ===================== */

 


  /* ===================== 이벤트 목록 스타일 ===================== */


  .toggle-btn {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    width: 100%;
    text-align: center;
  }

  .filter-list.open {
    display: block;
  }
  
</style>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
{% endblock %}

{% block main %}
<header class="navbar">
  <ul class="button-list">
    <!-- 새 이벤트 추가 버튼 -->
    <li><a href="{{ url_for('add_event') }}" id="add-event-btn" class="btn custom-btn">새 이벤트 추가</a></li>

    <!-- 지도 보기 버튼 -->
    <li><a href="{{ url_for('map_view') }}" class="btn custom-btn">지도 페이지로 이동</a></li>

    <!-- 달력 보기 버튼 -->
    <li><a href="{{ url_for('show_calendar', year=2025, month=2) }}" id="calendar-btn" class="btn custom-btn">
        <i class="bi bi-calendar-week"></i> 달력 보기
      </a>
    </li>
    <li><a href="{{ url_for('my_events', user_id=session['userid']) }}">
      <button type="button">내 이벤트 보기</button>
  </a>
  </li>

    <!-- 카테고리 필터링 버튼 -->
    <li>
      <button id="filter-toggle-btn" class="btn custom-btn">카테고리 필터링</button>
      <!-- 카테고리 체크박스 리스트 -->
      <div class="filter-list" id="filter-list">
        <form id="category-filter-form">
          {% for category in categories %}
          <div>
            <input type="checkbox" class="category-checkbox" value="{{ category }}" id="category-{{ category }}">
            <label for="category-{{ category }}">{{ category }}</label>
          </div>
          {% endfor %}
        </form>
      </div>
    </li>
  </ul>
</header>

<!-- 이벤트 목록 -->

<div id="container-fluid" class="row">
  {% for event in events %}
  <div class="col-lg-4 col-md-6 col-12 mb-4 event" data-category="{{ event.category }}">
    <!-- 각 이벤트에 data-category 추가 -->
    <div class="square-column">
      <!-- 이미지 영역 -->
      <a href="{{ url_for('view_event', id=event.id) }}">
        {% if event.filename %}
        <img src="{{ url_for('static', filename='uploads/' + event.filename) }}" class="event-image"
          alt="Event Image" />
        {% else %}
        <img src="{{ url_for('static', filename='uploads/thanos-gangnam-style.gif') }}" class="event-image"
          alt="Event Image" />
        {% endif %}
      </a>
      <!-- 텍스트 영역 -->
      <div class="event-details">
        <small style="font-size: 10px; color: #888;">
          {% if event.start_date.year == 2025 %}
          {{ event.start_date.strftime('%m-%d') }} {{event.location}}
          {% else %}
          {{ event.start_date.strftime('%Y-%m-%d') }} {{event.location}}
          {% endif %}
        </small><br>
        <h5 style="font-size: 16px; font-weight: bold;">{{ event.title }}</h5>

        <!-- 참가비 출력 -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
          {% if event.entryfee == 0 %}
          <small class="entryfee" style="font-size: 13px;">참가비: 무료</small>
          {% else %}
          <small class="entryfee" style="font-size: 13px;">참가비: {{ event.entryfee }}원~</small>
          {% endif %}
          <small style="color: #acacac;">조회 {{event.views}}</small>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- 페이지네이션 컨테이너 -->
<div class="pagination-container">
  <div class="pagination">
    <!-- 이전 페이지 링크 (비활성화 적용) -->
    {% if current_page > 1 %}
    <a href="{{ url_for('event', page=current_page - 1) }}">이전</a>
    {% else %}
    <a href="#" class="disabled">이전</a>
    {% endif %}

    <!-- 페이지 번호 링크 -->
    {% for page_num in range(1, total_pages + 1) %}
    <a href="{{ url_for('event', page=page_num) }}" {% if page_num==current_page %} class="active" {% endif %}>
      {{ page_num }}
    </a>
    {% endfor %}

    <!-- 다음 페이지 링크 (비활성화 적용) -->
    {% if current_page < total_pages %} <a href="{{ url_for('event', page=current_page + 1) }}">다음</a>
      {% else %}
      <a href="#" class="disabled">다음</a>
      {% endif %}
  </div>

</div>

{% endblock %}
{% block script %}


<!-- JavaScript 필터링 코드 -->
<script>
  // 네비게이션 필터링 메뉴 접고 펼치기
  const filterToggleBtn = document.getElementById('filter-toggle-btn');
  const filterList = document.getElementById('filter-list');

  filterToggleBtn.addEventListener('click', () => {
    filterList.classList.toggle('open'); // filter-list에 'open' 클래스를 추가/제거
  });


  // 체크박스 상태가 변경될 때마다 필터링 실행
  document.querySelectorAll('.category-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', function () {
      filterEvents();
    });
  });

  // 필터링 함수
  function filterEvents() {
    // 선택된 카테고리들
    const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(checkbox => checkbox.value);
    console.log('선택된 카테고리:', selectedCategories);  // 선택된 카테고리 확인

    // 이벤트들을 모두 가져옴
    const events = document.querySelectorAll('.event');

    // 이벤트들을 필터링
    events.forEach(event => {
      const eventCategory = event.getAttribute('data-category');
      console.log(`이벤트 카테고리: ${eventCategory}, 선택된 카테고리들: ${selectedCategories}`);

      // 선택된 카테고리 중 하나라도 해당하면 보이고, 아니면 숨김
      if (selectedCategories.length === 0 || selectedCategories.includes(eventCategory)) {
        event.style.display = 'block';  // 보이기
      } else {
        event.style.display = 'none';   // 숨기기
      }
    });
  }
</script>



{% endblock %}